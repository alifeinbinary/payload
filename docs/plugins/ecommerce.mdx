---
title: Ecommerce Plugin
label: Ecommerce
order: 120
desc: Add ecommerce functionality to your Payload CMS application with this plugin.
keywords: plugins, ecommerce, stripe, plugin, payload, cms, shop, payments
---

![https://www.npmjs.com/package/@payloadcms/plugin-ecommerce](https://img.shields.io/npm/v/@payloadcms/plugin-ecommerce)

This plugin allows you to add ecommerce functionality to your Payload app. It provides a set of utilities and collections to manage products, orders, and payments. It also integrates with popular payment gateways like Stripe to handle transactions.

<Banner type="info">
  This plugin is completely open-source and the [source code can be found
  here](https://github.com/payloadcms/payload/tree/main/packages/plugin-ecommerce).
  If you need help, check out our [Community
  Help](https://payloadcms.com/community-help). If you think you've found a bug,
  please [open a new
  issue](https://github.com/payloadcms/payload/issues/new?assignees=&labels=plugin%3A%redirects&template=bug_report.md&title=plugin-ecommerce%3A)
  with as much detail as possible.
</Banner>

## Core features

The plugin ships with a wide range of features to help you get started with ecommerce:

- Products with Variants are supported by default
- Carts are tracked in Payload
- Orders and Transactions
- Addresses linked to your Customers
- Stripe Payments integration
- Any number of currencies supported
- React UI utilities to help you manage your frontend logic

## Installation

Install the plugin using any JavaScript package manager like [pnpm](https://pnpm.io), [npm](https://npmjs.com), or [Yarn](https://yarnpkg.com):

```bash
  pnpm add @payloadcms/plugin-ecommerce
```

## Basic Usage

In the `plugins` array of your [Payload Config](https://payloadcms.com/docs/configuration/overview), call the plugin with [options](#options):

```ts
import { buildConfig } from 'payload'
import { ecommercePlugin } from '@payloadcms/plugin-ecommerce'

const config = buildConfig({
  collections: [
    {
      slug: 'pages',
      fields: [],
    },
  ],
  plugins: [
    ecommercePlugin({
      customers: { slug: 'users' },
    }),
  ],
})

export default config
```

## Options

| Option         | Type               | Description                                                                                                              |
| -------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------ |
| `access`       | `object`           | Configuration to override the default access control, use this when checking for roles or multi tenancy. [More](#access) |
| `addresses`    | `object`           | Configuration for addresses collection and supported fields. [More](#addresses)                                          |
| `carts`        | `object`           | Configuration for carts collection. [More](#carts)                                                                       |
| `currencies`   | `object`           | Supported currencies by the store. [More](#currencies)                                                                   |
| `customers`    | `object`           | Used to provide the customers slug. [More](#customers)                                                                   |
| `inventory`    | `boolean` `object` | Enable or disable inventory tracking within Payload. Defaults to `true`.                                                 |
| `payments`     | `object`           | Configuring payments and supported payment methods. [More](#payments)                                                    |
| `products`     | `object`           | Configuration for products, variants collections and more. [More](#products)                                             |
| `orders`       | `object`           | Configuration for orders collection. [More](#orders)                                                                     |
| `transactions` | `boolean` `object` | Configuration for transactions collection. [More](#transactions)                                                         |

Note that the fields in overrides take a function that receives the default fields and returns an array of fields. This allows you to add fields to the collection.

```ts
ecommercePlugin({
  access: {
    isAdmin: isAdmin,
    isAdminField: isAdminField,
    isAdminOrOwner: isAdminOrOwner,
    isAdminOrPublished: isAdminOrPublished,
    isCustomerField: isCustomerField,
  },
  customers: {
    slug: 'users',
  },
  payments: {
    paymentMethods: [
      stripeAdapter({
        secretKey: process.env.STRIPE_SECRET_KEY!,
        publishableKey: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!,
        webhookSecret: process.env.STRIPE_WEBHOOKS_SIGNING_SECRET!,
      }),
    ],
  },
  products: {
    variants: {
      variantsCollection: VariantsCollection,
    },
    productsCollection: ProductsCollection,
  },
})
```

## Access

The plugin requires access control functions in order to restrict permissions to certain collections or fields. You can override these functions by providing your own in the `access` option.

| Option               | Type          | Description                                                               |
| -------------------- | ------------- | ------------------------------------------------------------------------- |
| `isAuthenticated`    | `Access`      | Authenticated access only, provided by default.                           |
| `isPublic`           | `Access`      | Public access, provided by default.                                       |
| `isAdmin`            | `Access`      | Limited to only admin users.                                              |
| `isAdminField`       | `FieldAccess` | Limited to only admin users, specifically for Field level access control. |
| `isAdminOrOwner`     | `Access`      | Is the owner of the document via the `customer` field or is an admin.     |
| `isAdminOrPublished` | `Access`      | The document is published or user is admin.                               |
| `isCustomerField`    | `FieldAccess` | Limited to customers only, specifically for Field level access control.   |

The default access control functions are:

```ts
access: {
  isAuthenticated: ({ req: { user } }) => Boolean(user),
  isPublic: () => true,
}
```

### `isAuthenticated`

Access control to check if the user is authenticated. By default the following is provided:

```ts
isAuthenticated: ({ req: { user } }) => Boolean(user)
```

### `isPublic`

Access control to allow public access. By default the following is provided:

```ts
isPublic: () => true
```

### `isAdmin`

Access control to check if the user has `admin` permissions.

Example:

```ts
isAdmin: ({ req: { user } }) => Boolean(user?.roles?.includes('admin'))
```

### `isAdminField`

Field level access control to check if the user has `admin` permissions.

Example:

```ts
isAdminField: ({ req: { user } }) => Boolean(user?.roles?.includes('admin'))
```

### `isAdminOrOwner`

Access control to check if the user has `admin` permissions or is the owner of the document via the `customer` field.

Example:

```ts
isAdminOrOwner: ({ req: { user } }) => {
  if (user && Boolean(user?.roles?.includes('admin'))) {
    return true
  }

  if (user?.id) {
    return {
      customer: {
        equals: user.id,
      },
    }
  }

  return false
}
```

### `isAdminOrPublished`

Access control to check if the user has `admin` permissions or if the document is published.

Example:

```ts
isAdminOrPublished: ({ req: { user } }) => {
  if (user && Boolean(user?.roles?.includes('admin'))) {
    return true
  }
  return {
    _status: {
      equals: 'published',
    },
  }
}
```

### `isCustomerField`

Field level access control to check if the user has `customer` permissions.

Example:

```ts
isCustomerField: ({ req: { user } }) =>
  Boolean(user?.roles?.includes('customer'))
```

## Customers

The `customers` option is required and is used to provide the customers collection slug. This collection is used to link orders, carts, and addresses to a customer.

| Option | Type   | Description                           |
| ------ | ------ | ------------------------------------- |
| `slug` | string | The slug of the customers collection. |

## Payments

The `payments` option is used to configure payments and supported payment methods.

| Option           | Type    | Description                                                                                       |
| ---------------- | ------- | ------------------------------------------------------------------------------------------------- |
| `paymentMethods` | `array` | An array of payment method adapters. Currently, only Stripe is supported. [More](#stripe-adapter) |

### Payment adapters

The plugin supports payment adapters to integrate with different payment gateways. Currently, only the [Stripe adapter](#stripe-adapter) is available. Adapters will provide a client side version as well with slightly different arguments.

Every adapter supports the following arguments in addition to their own:

| Argument         | Type                               | Description                                                             |
| ---------------- | ---------------------------------- | ----------------------------------------------------------------------- |
| `label`          | `string`                           | Human readabale label for this payment adapter.                         |
| `groupOverrides` | `GroupField` with `FieldsOverride` | Use this to override the available fields for the payment adapter type. |

Client side base arguments are the following:

| Argument | Type     | Description                                     |
| -------- | -------- | ----------------------------------------------- |
| `label`  | `string` | Human readabale label for this payment adapter. |

See the [Stripe adapter](#stripe-adapter) for an example of client side arguments and the [React section](#react) for usage.

#### `groupOverrides`

The `groupOverrides` option allows you to customize the fields that are available for a specific payment adapter. It takes a `GroupField` object with a `fields` function that receives the default fields and returns an array of fields.
These fields are stored in transactions and can be used to collect additional information for the payment method. Stripe, for example, will track the `paymentIntentID`.

Example for overriding the default fields:

```ts
payments: {
  paymentMethods: [
    stripeAdapter({
      secretKey: process.env.STRIPE_SECRET_KEY,
      publishableKey: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,
      webhookSecret: process.env.STRIPE_WEBHOOKS_SIGNING_SECRET,
      groupOverrides: {
        fields: ({ defaultFields }) => {
          return [
            ...defaultFields,
            {
              name: 'customField',
              label: 'Custom Field',
              type: 'text',
            },
          ]
        }
      }
    }),
  ],
},
```

### Stripe Adapter

The Stripe adapter is used to integrate with the Stripe payment gateway. It requires a secret key, publishable key, and optionally webhook secret.

<Banner type="info">
  Note that Payload will not install the Stripe SDK package for you
  automatically, so you will need to install it yourself:

```
pnpm add stripe
```

</Banner>

| Argument         | Type               | Description                                                                                                                                                                          |
| ---------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `secretKey`      | `string`           | Required for communicating with the Stripe API in the backend.                                                                                                                       |
| `publishableKey` | `string`           | Required for communicating with the Stripe API in the client side.                                                                                                                   |
| `webhookSecret`  | `string`           | The webhook secret used to verify incoming webhook requests from Stripe.                                                                                                             |
| `webhooks`       | `WebhookHandler[]` | An array of webhook handlers to register within Payload's REST API for Stripe to callback.                                                                                           |
| `apiVersion`     | `string`           | The Stripe API version to use. See [docs](https://stripe.com/docs/api/versioning). This will be deprecated soon by Stripe's SDK, configure the API version in your Stripe Dashboard. |
| `appInfo`        | `object`           | The application info to pass to Stripe. See [docs](https://stripe.com/docs/api/app_info).                                                                                            |

```ts
import { stripeAdapter } from '@payloadcms/plugin-ecommerce/payments/stripe'

stripeAdapter({
  secretKey: process.env.STRIPE_SECRET_KEY!,
  publishableKey: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!,
  webhookSecret: process.env.STRIPE_WEBHOOKS_SIGNING_SECRET!,
})
```

#### Stripe `webhooks`

The `webhooks` option allows you to register custom webhook handlers for [Stripe events](https://docs.stripe.com/api/events). This is useful if you want to handle specific events that are not covered by the default handlers provided by the plugin.

```ts
stripeAdapter({
  webhooks: {
    'payment_intent.succeeded': ({ event, req }) => {
      // Access to Payload's req object and event data
    },
  },
}),
```

#### Stripe client side

On the client side, you can use the `publishableKey` to initialize Stripe and handle payments. The client side version of the adapter only requires the `label` and `publishableKey` arguments. Never expose the `secretKey` or `webhookSecret` keys on the client side.

```ts
import { stripeAdapterClient } from '@payloadcms/plugin-ecommerce/payments/stripe'

<EcommerceProvider
  paymentMethods={[
    stripeAdapterClient({
      publishableKey: process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,
    }),
  ]}
>
  {children}
</EcommerceProvider>
```

## Addresses

The `addresses` option is used to configure the addresses collection and supported fields. Defaults to `true` which will create an `addresses` collection with default fields. It also takes an object:

| Option               | Type                 | Description                                                                                                                                                  |
| -------------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `addressFields`      | `FieldsOverride`     | A function that is given the `defaultFields` as an argument and returns an array of fields. Use this to customise the supported fields for stored addresses. |
| `collectionOverride` | `CollectionOverride` | Allows you to override the collection for `addresses` where the `fields` is a function of type `FieldsOverride` and expects a return of a `Field` array.     |
| `supportedCountries` | `CountryType[]`      | An array of supported countries in [ISO 3166-1 alpha-2 format](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2). Defaults to all countries.                 |

You can add your own fields or modify the structure of the existing on in the collection. Example for overriding the default fields:

```ts
addresses: {
  collectionOverride: {
    fields: ({ defaultFields }) => {
      const fields = [
        ...defaultFields,
        {
          name: 'googleMapLocation',
          label: 'Google Map Location',
          type: 'text',
        },
      ]

      return fields
    },
  }
}
```

### `supportedCountries`

The `supportedCountries` option is an array of country codes in [ISO 3166-1 alpha-2 format](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2). This is used to limit the countries that can be selected when creating or updating an address. If not provided, all countries will be supported. Currently used for storing addresses only.

You can import the default list of countries from the plugin:

```ts
import { defaultCountries } from '@payloadcms/plugin-ecommerce/addresses'
```

## Carts

The `carts` option is used to configure the carts collection. Defaults to `true` which will create a `carts` collection with default fields. It also takes an object:

| Option            | Type                 | Description                                                                                                                                          |
| ----------------- | -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| `cartsCollection` | `CollectionOverride` | Allows you to override the collection for `carts` where the `fields` is a function of type `FieldsOverride` and expects a return of a `Field` array. |

You can add your own fields or modify the structure of the existing on in the collection. Example for overriding the default fields:

```ts
carts: {
  cartsCollection: {
    fields: ({ defaultFields }) => {
      const fields = [
        ...defaultFields,
        {
          name: 'notes',
          label: 'Notes',
          type: 'textarea',
        },
      ]
      return fields
    },
  }
}
```

## Currencies

The `currencies` option is used to configure the supported currencies by the store. Defaults to `true` which will support `USD`. It also takes an object:

| Option                | Type         | Description                                                                                                                     |
| --------------------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| `supportedCurrencies` | `Currency[]` | An array of supported currencies by the store. Defaults to `USD`. See [Currencies](#currencies-list) for available currencies.  |
| `defaultCurrency`     | `string`     | The default currency code to use for the store. Defaults to the first currency. Must be one of the `supportedCurrencies` codes. |

The `Currency` type is as follows:

```ts
type Currency = {
  code: string // The currency code in ISO 4217 format, e.g. 'USD'
  decimals: number // The number of decimal places for the currency, e.g. 2 for USD
  label: string // A human-readable label for the currency, e.g. 'US Dollar'
  symbol: string // The currency symbol, e.g. '$'
}
```

For example, to support JYP in addition to USD:

```ts
import { ecommercePlugin } from '@payloadcms/plugin-ecommerce'
import { USD } from '@payloadcms/plugin-ecommerce/currencies'

ecommercePlugin({
  currencies: {
    supportedCurrencies: [
      USD,
      {
        code: 'JPY',
        decimals: 0,
        label: 'Japanese Yen',
        symbol: '¥',
      },
    ],
    defaultCurrency: 'USD',
  },
})
```

Note that adding a new currency could generate a new schema migration as it adds new prices fields in your products.

We currently support the following currencies out of the box:

- `USD`
- `EUR`
- `GBP`

You can import these from the plugin:

```ts
import { EUR } from '@payloadcms/plugin-ecommerce/currencies'
```

<Banner type="info">
  Note that adding new currencies here does not automatically enable them in
  your payment gateway. Make sure to enable the currencies in your payment
  gateway dashboard as well.
</Banner>

## Products

The `products` option is used to configure the products and variants collections. Defaults to `true` which will create `products` and `variants` collections with default fields. It also takes an object:

| Option               | Type                 | Description                                                                                                                                             |
| -------------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `productsCollection` | `CollectionOverride` | Allows you to override the collection for `products` where the `fields` is a function of type `FieldsOverride` and expects a return of a `Field` array. |
| `variants`           | `object`             | Configuration for the variants collection. [More](#variants)                                                                                            |

You can add your own fields or modify the structure of the existing on in the collections. Example for overriding the default fields:

```ts
products: {
  productsCollection: {
    fields: ({ defaultFields }) => {
      const fields = [
        ...defaultFields,
        {
          name: 'customField',
          label: 'Custom Field',
          type: 'text',
        },
      ]
      return fields
    },
  }
}
```

### Variants

The `variants` option is used to configure the variants collection. It takes an object:

| Option               | Type                 | Description                                                                                                                                             |
| -------------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `variantsCollection` | `CollectionOverride` | Allows you to override the collection for `variants` where the `fields` is a function of type `FieldsOverride` and expects a return of a `Field` array. |

You can add your own fields or modify the structure of the existing on in the collection. Example for overriding the default fields:

```ts
variants: {
  variantsCollection: {
    fields: ({ defaultFields }) => {
      const fields = [
        ...defaultFields,
        {
          name: 'customField',
          label: 'Custom Field',
          type: 'text',
        },
      ]
      return fields
    },
  }
}
```

## Orders

The `orders` option is used to configure the orders collection. Defaults to `true` which will create an `orders` collection with default fields. It also takes an object:

| Option             | Type                 | Description                                                                                                                                           |
| ------------------ | -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ordersCollection` | `CollectionOverride` | Allows you to override the collection for `orders` where the `fields` is a function of type `FieldsOverride` and expects a return of a `Field` array. |

You can add your own fields or modify the structure of the existing on in the collection. Example for overriding the default fields:

```ts
orders: {
  ordersCollection: {
    fields: ({ defaultFields }) => {
      const fields = [
        ...defaultFields,
        {
          name: 'notes',
          label: 'Notes',
          type: 'textarea',
        },
      ]
      return fields
    },
  }
}
```

## Transactions

The `transactions` option is used to configure the transactions collection. Defaults to `true` which will create a `transactions` collection with default fields. It also takes an object:

| Option                   | Type                 | Description                                                                                                                                                 |
| ------------------------ | -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `transactionsCollection` | `CollectionOverride` | Allows you to override the collection for `transactions` where the `fields` is a function of type `FieldsOverride` and expects a return of a `Field` array. |

You can add your own fields or modify the structure of the existing on in the collection. Example for overriding the default fields:

```ts
transactions: {
  transactionsCollection: {
    fields: ({ defaultFields }) => {
      const fields = [
        ...defaultFields,
        {
          name: 'notes',
          label: 'Notes',
          type: 'textarea',
        },
      ]
      return fields
    },
  }
}
```

## React

The plugin provides a set of React utilities to help you manage your ecommerce frontend. These include context providers, hooks, and components to handle carts, products, and payments.

The following hooks and components are available:

| Hook / Component    | Description                                                                    |
| ------------------- | ------------------------------------------------------------------------------ |
| `EcommerceProvider` | A context provider to wrap your application and provide the ecommerce context. |
| `useCart`           | A hook to manage the cart state and actions.                                   |
| `useAddresses`      | A hook to fetch and manage products.                                           |
| `usePayments`       | A hook to manage the checkout process.                                         |
| `useCurrency`       | A hook to format prices based on the selected currency.                        |
| `useEcommerce`      | A hook that encompasses all of the above in one.                               |

### `EcommerceProvider`

The `EcommerceProvider` component is used to wrap your application and provide the ecommerce context. It takes the following props:

| Prop               | Type               | Description                                                                                         |
| ------------------ | ------------------ | --------------------------------------------------------------------------------------------------- |
| `children`         | `ReactNode`        | The child components that will have access to the ecommerce context.                                |
| `paymentMethods`   | `PaymentMethod[]`  | An array of payment method adapters for the client side. See [Payment adapters](#payment-adapters). |
| `enableVariants`   | `boolean`          | Enable or disable product variants support. Defaults to `true`.                                     |
| `currenciesConfig` | `CurrenciesConfig` | Configuration for supported currencies. See [Currencies](#currencies).                              |

Example usage:

```tsx
import { EcommerceProvider } from '@payloadcms/plugin-ecommerce/react'
// Import any payment adapters you want to use on the client side
import { stripeAdapterClient } from '@payloadcms/plugin-ecommerce/payments/stripe'
import { USD, EUR } from '@payloadcms/plugin-ecommerce/currencies'

export const Providers = () => (
  <EcommerceProvider
    enableVariants={true}
    currenciesConfig={{
      supportedCurrencies: [USD, EUR],
      defaultCurrency: 'USD',
    }}
  >
    {children}
  </EcommerceProvider>
)
```

### `useCart`

The `useCart` hook is used to manage the cart state and actions. It provides methods to add, remove, and update items in the cart, as well as to fetch the current cart state.

Example usage:

```tsx
import { useCart } from '@payloadcms/plugin-ecommerce/react'

const CartComponent = () => {
  const { addItem, cart, clearCart, decrementItem, incrementItem, removeItem } =
    useCart()

  // Your component logic here
}
```

### `useAddresses`

The `useAddresses` hook is used to fetch and manage addresses. It provides methods to create, update, and delete addresses, as well as to fetch the list of addresses.

It has the following properties:

| Property        | Type                                                                | Description                           |
| --------------- | ------------------------------------------------------------------- | ------------------------------------- |
| `addresses`     | `Address[]`                                                         | The list of addresses.                |
| `createAddress` | `(address: AddressInput) => Promise<Address>`                       | Method to create a new address.       |
| `updateAddress` | `(id: string \| number, address: AddressInput) => Promise<Address>` | Method to update an existing address. |

Example usage:

```tsx
import { useAddresses } from '@payloadcms/plugin-ecommerce/react'

const AddressesComponent = () => {
  const { addresses, createAddress, updateAddress } = useAddresses()

  // Your component logic here
}
```

### `usePayments`

The `usePayments` hook is used to manage the checkout process. It provides methods to initiate payments, confirm orders, and handle payment status.

Example usage:

```tsx
import { usePayments } from '@payloadcms/plugin-ecommerce/react'

const CheckoutComponent = () => {
  const {
    confirmOrder,
    initiatePayment,
    paymentMethods,
    selectedPaymentMethod,
  } = usePayments()

  // Your component logic here
}
```

### `useCurrency`

The `useCurrency` hook is used to format prices based on the selected currency. It provides methods to format prices and to get the current currency.

Example usage:

```tsx
import { useCurrency } from '@payloadcms/plugin-ecommerce/react'

const PriceComponent = ({ amount }) => {
  const { currenciesConfig, currency, setCurrency } = useCurrency()

  return <div>{formatPrice(amount)}</div>
}
```

### `useEcommerce`

The `useEcommerce` hook encompasses all of the above hooks in one. It provides access to the cart, addresses, and payments hooks.

Example usage:

```tsx
import { useEcommerce } from '@payloadcms/plugin-ecommerce/react'

const EcommerceComponent = () => {
  const { cart, addresses, selectedPaymentMethod } = useEcommerce()

  // Your component logic here
}
```

## TypeScript

All types can be directly imported:

```ts
import { PluginConfig } from '@payloadcms/plugin-ecommerce/types'
```

## Examples

The [Templates Directory](https://github.com/payloadcms/payload/tree/main/templates) also contains an official [E-commerce Template](https://github.com/payloadcms/payload/tree/main/templates/ecommerce), which uses this plugin.
